/**
 * Copyright (c) Facebook, Inc. and its affiliates. All Rights Reserved.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */

// Make sure to run node with --expose-gc option!

// The times are reliable if about 1% relative mean error if you run it:

// * immediately after restart
// * with 100% battery charge
// * not connected to network

/* eslint import/no-extraneous-dependencies: "off" */

const Benchmark = require('benchmark');

const diffBaseline = require('diff').diffLines;
const diffImproved = require('../build/index.js').default;

const testBaseline = (a, b) => {
  const benchmark = new Benchmark({
    fn() {
      diffBaseline(a, b);
    },
    name: 'baseline',
    onCycle() {
      global.gc(); // after run cycle
    },
    onStart() {
      global.gc(); // when benchmark starts
    },
  });

  benchmark.run({async: false});

  return benchmark.stats;
};

const testImproved = function(a, b) {
  const benchmark = 